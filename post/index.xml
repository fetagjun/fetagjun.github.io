<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on My New Hugo Site</title>
    <link>https://fetagjun.github.io/post/</link>
    <description>Recent content in Posts on My New Hugo Site</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Fri, 24 May 2019 14:50:04 +0800</lastBuildDate>
    
	<atom:link href="https://fetagjun.github.io/post/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Windows配置AD域</title>
      <link>https://fetagjun.github.io/post/blog/</link>
      <pubDate>Fri, 24 May 2019 14:50:04 +0800</pubDate>
      
      <guid>https://fetagjun.github.io/post/blog/</guid>
      <description>一 为什么需要域？
对很多刚开始钻研微软技术的朋友来说，域是一个让他们感到很头疼的对象。域的重要性毋庸置疑，微软的重量级服务产品基本上都需要域的支持，很多公司招聘工程师的要求中也都明确要求应聘者熟悉或精通Active Directory。但域对初学者来说显得复杂了一些，众多的技术术语，例如Active Directory，站点，组策略，复制拓扑，操作主机角色，全局编录….很多初学者容易陷入这些技术细节而缺少了对全局的把握。从今天开始，我们将推出Active Directory系列博文，希望对广大学习AD的朋友有所帮助。 今天我们谈论的第一个问题就是为什么需要域这个管理模型？众所周知，微软管理计算机可以使用域和工作组两个模型，默认情况下计算机安装完操作系统后是隶属于工作组的。我们从很多书里可以看到对工作组特点的描述，例如工作组属于分散管理，适合小型网络等等。我们这时要考虑一个问题，为什么工作组就不适合中大型网络呢，难道每台计算机分散管理不好吗？下面我们通过一个例子来讨论这个问题。 假设现在工作组内有两台计算机，一台是服务器Florence，一台是客户机Perth。服务器的职能大家都知道，无非是提供资源和分配资源。服务器提供的资源有多种形式，可以是共享文件夹，可以是共享打印机，可以是电子邮箱，也可以是数据库等等。现在服务器Florence提供一个简单的共享文件夹作为服务资源，我们的任务是要把这个共享文件夹的访问权限授予公司内的员工张建国，注意，这个文件夹只有张建国一个人可以访问！那我们就要考虑一下如何才能实现这个任务，一般情况下管理员的思路都是在服务器上为张建国这个用户创建一个用户账号，如果访问者能回答出张建国账号的用户名和密码，我们就认可这个访问者就是张建国。基于这个朴素的管理思路，我们来在服务器上进行具体的实施操作。 首先，如下图所示，我们在服务器上为张建国创建了用户账号。
然后在共享文件夹中进行权限分配，如下图所示，我们只把共享文件夹的读权限授予了用户张建国。
好，接下来张建国就在客户机Perth上准备访问服务器上的共享文件夹了，张建国准备访问资源\Florence\人事档案，服务器对访问者提出了身份验证请求，如下图所示，张建国输入了自己的用户名和口令。
如下图所示，张建国成功地通过了身份验证，访问到了目标资源。
看完了这个实例之后，很多朋友可能会想，在工作组模式下这个问题解决得很好啊，我们不是成功地实现了预期目标嘛！没错，在这个小型网络中，确实工作组模型没有暴露出什么问题。但是我们要把问题扩展一下！现在假设公司不是一台服务器，而是500台服务器，这大致是一个中型公司的规模，那么我们的麻烦就来了。如果这500台服务器上都有资源要分配给张建国，那会有什么样的后果呢？由于工作组的特点是分散管理，那么意味着每台服务器都要给张建国创建一个用户账号！张建国这个用户就必须痛不欲生地记住自己在每个服务器上的用户名和密码。而服务器管理员也好不到哪儿去，每个用户账号都重新创建500次！如果公司内有1000人呢？我们难以想象这么管理网络资源的后果，这一切的根源都是由于工作组的分散管理！现在大家明白为什么工作组不适合在大型的网络环境下工作了吧，工作组这种散漫的管理方式和大型网络所要求的高效率是背道而驰的。 既然工作组不适合大型网络的管理要求，那我们就要重新审视一下其他的管理模型了。域模型就是针对大型网络的管理需求而设计的，域就是共享用户账号，计算机账号和安全策略的计算机集合。从域的基本定义中我们可以看到，域模型的设计中考虑到了用户账号等资源的共享问题，这样域中只要有一台计算机为公司员工创建了用户账号，其他计算机就可以共享账号了。这样就很好地解决刚才我们提到的账号重复创建的问题。域中的这台集中存储用户账号的计算机就是域控制器，用户账号，计算机账号和安全策略被存储在域控制器上一个名为Active Directory的数据库中。 上述这个简单的例子说明的只是域强大功能的冰山一角，其实域的功能远远不止这些。从下篇博文我们将开始介绍域的部署以及管理，希望大家在使用过程中逐步增加感性认识，对域有更加深入及全面的了解，能够掌握好Active Directory这个微软工程师必备的重要知识点。
二 部署第一个域
在上篇博文中我们介绍了部署域的意义，今天我们来部署第一个域。一般情况下，域中有三种计算机，一种是域控制器，域控制器上存储着Active Directory；一种是成员服务器，负责提供邮件，数据库，DHCP等服务；还有一种是工作站，是用户使用的客户机。我们准备搭建一个基本的域环境，拓扑如下图所示，Florence是域控制器，Berlin是成员服务器，Perth是工作站。
部署一个域大致要做下列工作： 1 DNS前期准备 2 创建域控制器 3 创建计算机账号 4 创建用户账号
一 DNS前期准备 DNS服务器对域来说是不可或缺的，一方面，域中的计算机使用DNS域名，DNS需要为域中的计算机提供域名解析服务；另外一个重要的原因是域中的计算机需要利用DNS提供的SRV记录来定位域控制器，因此我们在创建域之前需要先做好DNS的准备工作。那么究竟由哪台计算机来负责做DNS服务器呢？一般工程师有两种选择，要么使用域控制器来做DNS服务器，要么使用一台单独的DNS服务器。我一般使用一台独立的计算机来充当DNS服务器，这台DNS服务器不但为域提供解析服务，也为公司其他的业务提供DNS解析支持，大家可以根据具体的网络环境来选择DNS服务器。 在创建域之前，DNS服务器需要做好哪些准备工作呢？ 1 创建区域并允许动态更新 首先我们要在DNS服务器上创建出一个区域，区域的名称和域名相同，域内计算机的DNS记录都创建在这个区域中。我们在DNS服务器上打开DNS管理器，如下图所示，右键单击正向查找区域，选择新建一个区域。出现新建区域向导后，点击下一步继续。
区域类型选择“主要区域”。
区域名称和域名相同，是adtest.com。
区域一定要允许动态更新，因为在创建域的过程中需要向DNS区域中写入A记录，SRV记录和Cname记录。
区域创建完毕，点击完成结束创建。
2 检查NS和SOA记录 区域创建完成后，一定要检查一下区域的NS记录和SOA记录。在前面的DNS课程中，我们已经介绍了NS记录和SOA记录的意义，NS记录描述了有多少个DNS服务器可以解析这个区域，SOA记录描述了哪个DNS服务器是区域的主服务器。如果NS记录和SOA记录出错，域的创建过程中就无法向DNS区域中写入应有的记录。在DNS服务器上打开DNS管理器，在adtest.com区域中检查ns记录，如下图所示，我们发现ns记录不是一个有效的完全合格域名，我们需要对它进行修改。
如下图所示，我们把ns记录改为 ns.adtest.com.，解析出的IP地址和DNS服务器的IP是吻合的，这样我们就完成了ns记录的修改。
如下图所示，我们把区域的SOA记录也同样进行修改，现在区域的主服务器是ns.adtest.com.，这样SOA记录也修改完毕了。
至此，DNS准备工作完成，我们接下来可以部署域了。
二 创建域控制器 有了DNS的支持，我们现在可以开始创建域控制器了，域控制器是域中的第一台服务器，域控制器上存储着Active Directory，可以说，域控制器就是域的灵魂。我们准备在Florence上创建域控制器，首先检查Florence网卡的TCP/IP属性，注意，Florence应该使用192.168.11.1作为自己的DNS服务器。因为我们刚刚在192.168.11.1上创建了adtest.com区域。
如下图所示，在Florence上运行Dcpromo，开始域控制器的创建。
如下图所示，出现Active Directory安装向导，创建域控制器其实就是在Florence上安装一个Active Directory数据库，点击下一步继续。
Adtest.com是一个新创建的域，因为我们选择创建“新域的域控制器”。
如下图所示，我们选择创建一个“在新林中的域”，这个选项是什么意思呢？我们虽然只是简单地创建了一个域，但其实从逻辑上讲是创建了一个域林。因为域一定要隶属于域树，域树一定要隶属于域林。因为我们实际上是创建了一个域林，虽然这个域林内只有一棵域树，域树内只有一个树根。
输入域的DNS名称，adtest.com。
域的NETBIOS名称是ADTEST，由于.在NETBIOS名称中是非法字符，因为基本上域的NETBIOS名称就是域名中.之前的部分。
Active Directory数据库的路径我们使用了默认值，如果在生产环境，可以考虑把数据库和日志部分分开存储。
Sysvol文件夹的路径我们也使用默认值，至于Sysvol文件夹是干嘛的，我们后续会有介绍。
接下来Active Directory的安装向导会对DNS服务器进行检测，检查是否在DNS服务器上已经创建了和域名相同的区域，而且区域是否允许动态更新。如下图所示，DNS检测通过。注意，如果DNS检测有问题，我们应该及时排除故障，而不应该继续向下进行。
接下来要选择用户和组的默认权限，我们选择了不允许匿名用户查询域中的信息。
设置一下还原模式的管理员口令，我们从备份中恢复Active Directory时需要用到。
好，如下图所示仔细检查一下创建域的各项设置是否正确，如果没有问题我们就开工了！
如下图所示，Active Directory安装向导开始在Florence上安装Active Directory。</description>
    </item>
    
  </channel>
</rss>